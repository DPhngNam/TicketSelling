# scripts/logstash/pipeline/logstash.conf
input {
  http {
    port => 5001
    codec => json # Expects JSON from the Serilog Http sink with ElasticsearchJsonFormatter
  }
}

filter {
  # Minimal filtering needed if Serilog sends well-structured JSON.
  # You might want to ensure the @timestamp is correctly interpreted
  # or add/remove specific fields if necessary.
  mutate {
    # Example: If Serilog's "Application" property is nested under "Properties",
    # you might want to move it to the root for easier access in Kibana.
    # This depends on the exact structure Serilog.Formatting.Elasticsearch.ElasticsearchJsonFormatter produces.
    # rename => { "[Properties][Application]" => "application_name" }
  }
}

output {
  stdout { codec => rubydebug } 
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    index => "ticketselling-debug-%{+YYYY.MM.dd}"
    manage_template => false # Simplifies initial connection
    # Remove license/xpack related settings for the output plugin temporarily if issues persist
  }
}