# scripts/logstash/pipeline/logstash.conf
input {
  http {
    port => 5001
    codec => json # Expects JSON from the Serilog Http sink with ElasticsearchJsonFormatter
  }
}

filter {
  # Minimal filtering needed if Serilog sends well-structured JSON.
  # You might want to ensure the @timestamp is correctly interpreted
  # or add/remove specific fields if necessary.
  mutate {
    # Example: If Serilog's "Application" property is nested under "Properties",
    # you might want to move it to the root for easier access in Kibana.
    # This depends on the exact structure Serilog.Formatting.Elasticsearch.ElasticsearchJsonFormatter produces.
    # rename => { "[Properties][Application]" => "application_name" }
  }
}

output {
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    # Define an index pattern for logs coming through Logstash
    index => "ticketselling-logstash-%{+YYYY.MM.dd}"
    # If your "Properties.Application" field exists from Serilog, you can use it:
    # index => "ticketselling-%{[Properties][Application]}-%{+YYYY.MM.dd}"
  }
  # For debugging Logstash itself:
  # stdout { codec => rubydebug }
}